// إعدادات Google AI - شفا كير
export interface GoogleAIConfig {
  apiKey: string;
  model: string;
  maxTokens: number;
  temperature: number;
  timeout: number;
  retries: number;
}

export interface AIPromptTemplate {
  system: string;
  user: string;
  variables: string[];
}

// الإعدادات الافتراضية
export const DEFAULT_GOOGLE_AI_CONFIG: GoogleAIConfig = {
  apiKey: import.meta.env.VITE_GOOGLE_AI_API_KEY || '',
  model: 'gemini-1.5-flash',
  maxTokens: 1000,
  temperature: 0.7,
  timeout: 30000,
  retries: 3
};

// قوالب الرسائل الجاهزة
export const AI_PROMPTS = {
  // تحليل الجلسات
  SESSION_ANALYSIS: {
    system: `أنت معالج نفسي محترف متخصص في علاج الإدمان. مهمتك تحليل الجلسات العلاجية وتقديم رؤى مفيدة باللهجة المصرية فقط.\n\nيجب أن تكون إجاباتك:\n- باللهجة المصرية البسيطة فقط\n- دقيقة ومهنية\n- عملية وقابلة للتطبيق\n- تراعي السياق الثقافي المصري\n- تحترم خصوصية المريض\n- لا تستخدم العربية الفصحى إطلاقًا\n- أي إجابة ليست باللهجة المصرية سيتم رفضها.\n\nأجب باللهجة المصرية فقط. لا تستخدم العربية الفصحى إطلاقًا.`,
    user: `قم بتحليل الجلسة التالية:\n\nالملاحظات الخام: {rawNotes}\n\nالمطلوب:\n1. إعادة كتابة الملاحظات بشكل منظم ومفهوم باللهجة المصرية فقط\n2. ملخص مختصر للجلسة\n3. تحليل المشاعر مع تحديد:\n   - المشاعر الأساسية\n   - المشاعر الثانوية  \n   - شدة المشاعر (1-10)\n   - الحالة العاطفية العامة\n\n- أجب باللهجة المصرية فقط. لا تستخدم العربية الفصحى إطلاقًا.`,
    variables: ['rawNotes']
  },

  // اقتراح خطط علاجية
  TREATMENT_PLAN: {
    system: `أنت خبير في علاج الإدمان. مهمتك إنشاء خطط علاجية شاملة ومخصصة بناءً على حالة المريض باللهجة المصرية فقط.\n\nيجب أن تكون خططك:\n- باللهجة المصرية فقط\n- مخصصة لحالة المريض\n- عملية وقابلة للتطبيق\n- تراعي السياق المصري\n- تشمل جميع جوانب العلاج\n- لها مؤشرات نجاح واضحة\n- لا تستخدم العربية الفصحى إطلاقًا\n- أي إجابة ليست باللهجة المصرية سيتم رفضها.\n\nأجب باللهجة المصرية فقط. لا تستخدم العربية الفصحى إطلاقًا.`,
    user: `معلومات المريض:\nالاسم: {patientName}\nالعمر: {age}\nنوع الإدمان: {addictionType}\nالحالة الحالية: {currentStatus}\nعوامل الخطر: {riskFactors}\n\nقم بإنشاء خطة علاجية شاملة تتضمن:\n1. نوع العلاج (فردي/جماعي/عائلي)\n2. مدة العلاج بالأسابيع\n3. عدد الجلسات أسبوعياً\n4. الأهداف العلاجية\n5. التدخلات المطلوبة\n6. استراتيجيات تقليل المخاطر\n7. مؤشرات النجاح\n\n- أجب باللهجة المصرية فقط. لا تستخدم العربية الفصحى إطلاقًا.`,
    variables: ['patientName', 'age', 'addictionType', 'currentStatus', 'riskFactors']
  },

  // تقييم مخاطر الانتكاس
  RELAPSE_RISK: {
    system: `أنت خبير في تقييم مخاطر الانتكاس في علاج الإدمان. مهمتك تحليل عوامل الخطر وتقديم توصيات عملية باللهجة المصرية فقط.\n\nيجب أن تكون تقييماتك:\n- باللهجة المصرية فقط\n- دقيقة ومبنية على الأدلة\n- عملية وقابلة للتطبيق\n- تراعي السياق المصري\n- تشمل خطوات وقائية واضحة\n- لا تستخدم العربية الفصحى إطلاقًا\n- أي إجابة ليست باللهجة المصرية سيتم رفضها.\n\nأجب باللهجة المصرية فقط. لا تستخدم العربية الفصحى إطلاقًا.`,
    user: `بيانات المريض:\n{patientData}\n\nتاريخ الجلسات:\n{sessionsHistory}\n\nقم بتقييم مخاطر الانتكاس وتقديم:\n1. مستوى الخطر (منخفض/متوسط/عالي/حرج)\n2. احتمالية الانتكاس (0-100%)\n3. عوامل الخطر الرئيسية\n4. التوصيات الوقائية\n5. موعد التقييم القادم\n\n- أجب باللهجة المصرية فقط. لا تستخدم العربية الفصحى إطلاقًا.`,
    variables: ['patientData', 'sessionsHistory']
  },

  // إنشاء تقارير ذكية
  SMART_REPORT: {
    system: `أنت خبير في كتابة التقارير الطبية. مهمتك إنشاء تقارير شاملة ومهنية عن حالة المرضى باللهجة المصرية فقط.\n\nيجب أن تكون تقاريرك:\n- باللهجة المصرية فقط\n- شاملة ومفصلة\n- مهنية ودقيقة\n- سهلة الفهم\n- تشمل توصيات عملية\n- تراعي السياق المصري\n- لا تستخدم العربية الفصحى إطلاقًا\n- أي إجابة ليست باللهجة المصرية سيتم رفضها.\n\nأجب باللهجة المصرية فقط. لا تستخدم العربية الفصحى إطلاقًا.`,
    user: `قم بإنشاء تقرير {reportType} شامل للمريض {patientId}.\n\nالمطلوب في التقرير:\n1. ملخص الحالة\n2. التقدم المحرز\n3. التحديات والعراقيل\n4. التوصيات العلاجية\n5. الخطوات التالية\n6. مؤشرات النجاح\n\n- أجب باللهجة المصرية فقط. لا تستخدم العربية الفصحى إطلاقًا.`,
    variables: ['reportType', 'patientId']
  },

  // اقتراح أنشطة علاجية
  THERAPEUTIC_ACTIVITIES: {
    system: `أنت خبير في الأنشطة العلاجية. مهمتك اقتراح أنشطة مناسبة لحالة المريض وأهدافه العلاجية باللهجة المصرية فقط.\n\nيجب أن تكون الأنشطة:\n- باللهجة المصرية فقط\n- مناسبة لحالة المريض\n- متنوعة وممتعة\n- تساعد في تحقيق الأهداف\n- قابلة للتطبيق في المركز\n- تراعي السياق المصري\n- لا تستخدم العربية الفصحى إطلاقًا\n- أي إجابة ليست باللهجة المصرية سيتم رفضها.\n\nأجب باللهجة المصرية فقط. لا تستخدم العربية الفصحى إطلاقًا.`,
    user: `بناءً على حالة المريض والجلسة، اقترح أنشطة مناسبة:\n\nبيانات المريض:\n{patientProfile}\n\nنتائج الجلسة:\n{sessionResults}\n\nاقترح أنشطة تشمل:\n- أنشطة علاجية فردية\n- أنشطة جماعية\n- أنشطة عائلية\n- أنشطة ترفيهية\n- أنشطة تعليمية\n\nكل نشاط يجب أن يكون:\n- مناسب لحالة المريض\n- له مدة محددة\n- له تكرار محدد\n- يساعد في تحقيق الأهداف العلاجية\n\n- أجب باللهجة المصرية فقط. لا تستخدم العربية الفصحى إطلاقًا.`,
    variables: ['patientProfile', 'sessionResults']
  }
};

// دوال مساعدة
export const createPrompt = (template: AIPromptTemplate, variables: Record<string, string>): string => {
  let prompt = template.user;
  
  for (const [key, value] of Object.entries(variables)) {
    prompt = prompt.replace(new RegExp(`{${key}}`, 'g'), value);
  }
  
  return prompt;
};

export const validateGoogleAIConfig = (config: GoogleAIConfig): boolean => {
  return !!(config.apiKey && config.apiKey.length > 0);
};

export const getGoogleAIConfig = (): GoogleAIConfig => {
  const config = { ...DEFAULT_GOOGLE_AI_CONFIG };
  
  // التحقق من وجود المفتاح
  if (!config.apiKey) {
    console.warn('Google AI API key not found. Please set VITE_GOOGLE_AI_API_KEY in your environment variables.');
  }
  
  return config;
}; 